<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Game Zone</title>
  <link rel="stylesheet" href="	https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" />
  <link rel="stylesheet" href="../static/index.css">
  <link rel="stylesheet" href="../static/tic-tac-toe.css">
  <link rel="stylesheet" href="../static/flappy-bird.css">
</head>

<body>
  <div class="container">
    <ul class="nav nav-pills p-2 main-navbar navbar1">
      <li class="nav-item">
        <a class="nav-link text-white" href="/main">Home</a>
      </li>
      <li class="nav-item">
        <a class="nav-link active bg-success" href="/games">Games</a>
      </li>
      <li class="nav-item">
        <a class="nav-link text-white" href="/ContactUs">Contact Us</a>
      </li>
      <li class="nav-item">
        <a class="nav-link text-white bg-danger logout" style="cursor: pointer;" data-bs-toggle="modal"
          data-bs-target="#logoutmodal">Log Out</a>
      </li>
    </ul>
  </div>


  <div class="container">
    <ul class="nav nav-tabs bg-success">
      <li class="nav-item">
        <a href="#game-1" class="nav-link text-info active" data-bs-target="#game-1" data-bs-toggle="tab">Game 1</a>
      </li>
      <li class="nav-item">
        <a href="#game-2" class="nav-link text-info" data-bs-target="#game-2" data-bs-toggle="tab">Game 2</a>
      </li>
      <li class="nav-item">
        <a href="#game-3" class="nav-link text-info" data-bs-target="#game-3" data-bs-toggle="tab">Game 3</a>
      </li>
      <li class="nav-item">
        <a href="#game-4" class="nav-link text-info" data-bs-target="#game-4" data-bs-toggle="tab">Game 4</a>
      </li>
      <li class="nav-item">
        <a href="#game-5" class="nav-link text-info" data-bs-target="#game-5" data-bs-toggle="tab"> Game 5</a>
      </li>
    </ul>

    <div class="tab-content">

      <div class="tab-pane fade show active" id="game-1">
        <div id="gameBoard">
          <div class="row justify-content-center">
            <div class="col-2 ox" tabindex="0"></div>
            <div class="col-2 ox" tabindex="0"></div>
            <div class="col-2 ox" tabindex="0"></div>
          </div>
          <div class="row justify-content-center">
            <div class="col-2 ox" tabindex="0"></div>
            <div class="col-2 ox" tabindex="0"></div>
            <div class="col-2 ox" tabindex="0"></div>
          </div>
          <div class="row justify-content-center">
            <div class="col-2 ox" tabindex="0"></div>
            <div class="col-2 ox" tabindex="0"></div>
            <div class="col-2 ox" tabindex="0"></div>
          </div>
          <div class="row justify-content-center">
            <p class="col display-4 align-content-center" id="message">X Turn</p>
          </div>
          <div class="row justify-content-center p-2 m-2">
            <button class="btn btn-success" style="width: 150px;" id="restart">Reset Game</button>
          </div>
        </div>
      </div>
      <div class="tab-pane fade" id="game-2">Game 2</div>
      <div class="tab-pane fade" id="game-3">Game 3</div>
      <div class="tab-pane fade" id="game-4">Game 4</div>
      <div class="tab-pane fade" id="game-5">Game 5</div>
    </div>
  </div>





  <div class="modal fade" id="logoutmodal">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h1 class="modal-title fs-5" id="exampleModalLabel">Log Out</h1>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          Do you want to log out from the game zone ...?
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">No</button>
          <a type="button" class="btn btn-primary" href="/logout">Yes</a>
        </div>
      </div>
    </div>
  </div>
  <script src="/js/tic-tac-toe.js"></script>
  <script src="/js/flappy-bird.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    window.onload = () => {
      let btnRef = document.querySelectorAll(".ox");
      let restartBtn = document.getElementById("restart");
      let msgRef = document.getElementById("message");

      let winning = [
        [0, 1, 2],
        [3, 4, 5],
        [6, 7, 8],
        [0, 3, 6],
        [1, 4, 7],
        [2, 5, 8],
        [0, 4, 8],
        [2, 4, 6],
      ];

      let userTurn = true; // User starts the game
      let count = 0;
      let gameOver = false; // Track if the game is over

      // Disable all cells
      const disableBtns = () => {
        btnRef.forEach((cell) => {
          cell.style.pointerEvents = "none";
        });
      };

      // Enable all cells and reset styles
      const enableBtns = () => {
        btnRef.forEach((cell) => {
          cell.innerText = "";
          cell.style.pointerEvents = "auto";
        });
        msgRef.innerHTML = "Your Turn (X)";
        userTurn = true;
        count = 0;
        gameOver = false;
      };

      // Display win message
      const winFunction = (letter) => {
        if (letter === "X") {
          msgRef.innerHTML = "User Wins! (X)";
        } else {
          msgRef.innerHTML = "Computer Wins! (O)";
        }
        disableBtns();
        gameOver = true; // Mark the game as over
      };

      // Display draw message
      const drawFunction = () => {
        msgRef.innerHTML = "It's a Draw!";
        gameOver = true; // Mark the game as over
      };

      // Reset game on restart button click
      restartBtn.addEventListener("click", () => {
        enableBtns();
      });

      // Check for win condition
      const winChecker = () => {
        for (let i of winning) {
          let [cell1, cell2, cell3] = [
            btnRef[i[0]].innerText,
            btnRef[i[1]].innerText,
            btnRef[i[2]].innerText,
          ];
          if (cell1 !== "" && cell1 === cell2 && cell2 === cell3) {
            winFunction(cell1);
            return true; // Stop further checks once we have a winner
          }
        }
        return false;
      };

      // Computer's move
      const computerMove = () => {
        if (gameOver) return; // Stop the computer if the game is over
        msgRef.innerHTML = "Computer's Turn (O)";
        setTimeout(() => {
          let availableCells = [];
          btnRef.forEach((cell, index) => {
            if (cell.innerText === "") {
              availableCells.push(index);
            }
          });

          // Choose a random cell for the computer
          if (availableCells.length > 0) {
            let randomIndex = Math.floor(Math.random() * availableCells.length);
            let selectedCell = btnRef[availableCells[randomIndex]];
            selectedCell.innerText = "O";
            selectedCell.style.pointerEvents = "none";
            count++;

            // Check for win or draw after computer's move
            if (!winChecker() && count === 9) {
              drawFunction();
            } else if (!gameOver) {
              msgRef.innerHTML = "Your Turn (X)";
              userTurn = true;
            }
          }
        }, 500); // Add a delay for realism
      };

      // Add click event listener to each cell
      btnRef.forEach((cell) => {
        cell.addEventListener("click", () => {
          if (userTurn && !gameOver) {
            cell.innerText = "X";
            cell.style.pointerEvents = "none"; // Disable the cell after it's clicked
            count++;
            userTurn = false;

            // Check for win or draw after user's move
            if (!winChecker() && count === 9) {
              drawFunction();
            } else if (!gameOver) {
              computerMove(); // Let the computer play
            }
          }
        });
      });

      // Initialize the game board
      enableBtns();
    };

  </script>
</body>

</html>